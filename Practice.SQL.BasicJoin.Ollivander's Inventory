SELECT ID, AGE, COINS_NEEDED, POWER
FROM WANDS W
INNER JOIN WANDS_PROPERTY WP ON W.CODE = WP.CODE
WHERE WP.IS_EVIL != 1
AND W.COINS_NEEDED = ( SELECT MIN(W2.COINS_NEEDED)
                       FROM WANDS W2
                       INNER JOIN WANDS_PROPERTY WP2 ON W2.CODE = WP2.CODE
                       WHERE WP2.AGE = WP.AGE AND W2.POWER = W.POWER)
ORDER BY W.POWER DESC, WP.AGE DESC;
